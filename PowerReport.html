<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dá Kų Cultural Centre - Energy Analysis Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Page-specific styles */
        .back-link {
            display: inline-block;
            color: var(--cafn-white);
            text-decoration: none;
            font-size: var(--font-size-sm);
            opacity: 0.8;
            margin-bottom: var(--space-md);
            transition: opacity var(--transition-fast);
        }

        .back-link:hover {
            opacity: 1;
        }

        .back-link::before {
            content: '← ';
        }

        /* Expandable chart containers */
        .chart-container.expandable {
            cursor: pointer;
        }

        .chart-container.expandable::after {
            content: 'Click to expand';
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            opacity: 0.6;
            transition: opacity var(--transition-fast);
        }

        .chart-container.expandable:hover::after {
            opacity: 1;
        }

        .chart-container.expanded {
            position: fixed;
            top: 5%;
            left: 5%;
            right: 5%;
            bottom: 5%;
            z-index: 1000;
            border-radius: var(--radius-xl);
        }

        .chart-container.expanded::after {
            content: 'Click to close';
        }

        .chart-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        .chart-overlay.visible {
            display: block;
        }

        /* Community Impact specific styles */
        .impact-story {
            background: linear-gradient(135deg, var(--cafn-dark) 0%, var(--cafn-dark-light) 100%);
            color: var(--cafn-white);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            margin-bottom: var(--space-xl);
        }

        .impact-story h3 {
            color: var(--cafn-red);
            margin-bottom: var(--space-md);
        }

        .impact-story p {
            line-height: 1.8;
            opacity: 0.9;
            margin-bottom: var(--space-md);
        }

        .impact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-lg);
            margin-top: var(--space-xl);
        }

        .impact-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .impact-card h4 {
            color: var(--success);
            margin-bottom: var(--space-sm);
        }

        .impact-card .value {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        .impact-card p {
            font-size: var(--font-size-sm);
            margin: 0;
        }

        /* Quick Facts sidebar */
        .quick-facts {
            background: var(--gray-100);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .quick-facts h3 {
            color: var(--cafn-dark);
            font-size: var(--font-size-lg);
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 2px solid var(--cafn-red);
        }

        .quick-fact {
            display: flex;
            justify-content: space-between;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--gray-300);
        }

        .quick-fact:last-child {
            border-bottom: none;
        }

        .quick-fact .label {
            color: var(--text-secondary);
        }

        .quick-fact .value {
            font-weight: 600;
            color: var(--cafn-dark);
        }

        .quick-fact .value.positive {
            color: var(--success);
        }
    </style>
</head>
<body>

<!-- Overlay for expanded charts -->
<div class="chart-overlay" id="chartOverlay" onclick="closeExpandedChart()"></div>

<!-- Header -->
<header class="report-header">
    <a href="index.html" class="back-link">Back to Home</a>
    <h1>Dá Kų Cultural Centre</h1>
    <p class="subtitle">Building Efficiency & Energy Analysis Report</p>
    <div class="meta">
        <span class="badge">2025 Annual Report</span>
        <span class="badge">Heat Pump Analysis</span>
    </div>
</header>

<div class="container" style="padding: var(--space-xl) var(--space-lg);">

    <!-- Tab Navigation -->
    <div class="tab-nav" id="mainTabs">
        <button class="tab-btn active" data-tab="executive" onclick="switchTab('executive')">
            Executive Summary
        </button>
        <button class="tab-btn" data-tab="technical" onclick="switchTab('technical')">
            Technical Detail
        </button>
        <button class="tab-btn" data-tab="community" onclick="switchTab('community')">
            Community Impact
        </button>
    </div>

    <!-- ========================================== -->
    <!-- EXECUTIVE SUMMARY TAB -->
    <!-- ========================================== -->
    <div id="executive" class="tab-content">

        <!-- Executive Summary Banner -->
        <div class="executive-summary">
            <h2>Cost Savings Success: $54,437 in 2025</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-value">$54,437</div>
                    <div class="summary-label">Total HVAC Savings</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">41%</div>
                    <div class="summary-label">Efficiency Gain</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">$46K</div>
                    <div class="summary-label">Annual Cost Reduction</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">$8,318</div>
                    <div class="summary-label">Best Month (Dec)</div>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card" style="--card-accent: var(--success);">
                <div class="kpi-title">2025 Total Cost</div>
                <div class="kpi-value">$98,111</div>
                <div class="kpi-sub">Down from $141,627 (2023)</div>
            </div>
            <div class="kpi-card" style="--card-accent: var(--info);">
                <div class="kpi-title">HVAC Cost 2025</div>
                <div class="kpi-value">$66,765</div>
                <div class="kpi-sub">Down from $112,783 (2023)</div>
            </div>
            <div class="kpi-card" style="--card-accent: var(--warning);">
                <div class="kpi-title">Total Usage 2025</div>
                <div class="kpi-value">283,500 kWh</div>
                <div class="kpi-sub">35% reduction from 2023</div>
            </div>
            <div class="kpi-card" style="--card-accent: var(--cafn-dark);">
                <div class="kpi-title">Heating Degree Days</div>
                <div class="kpi-value">8,352</div>
                <div class="kpi-sub">9% colder than 2023</div>
            </div>
        </div>

        <!-- Environmental Equivalents -->
        <div class="section-header">
            <h2>Environmental Impact</h2>
            <p>What our efficiency gains mean for the environment</p>
        </div>
        <div id="execEnvEquivalents"></div>

        <!-- Key Charts for Executives -->
        <div class="section-header" style="margin-top: var(--space-2xl);">
            <h2>Key Performance Charts</h2>
            <p>Visual summary of cost savings and efficiency</p>
        </div>

        <div class="charts-grid">
            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Cumulative Savings (2025)</div>
                        <div class="chart-subtitle">Growing savings throughout the year</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="execCumulativeChart"></canvas>
                </div>
            </div>

            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Annual Cost Comparison</div>
                        <div class="chart-subtitle">Total and HVAC costs by year</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="execAnnualChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 5-Year Projections -->
        <div class="section-header" style="margin-top: var(--space-2xl);">
            <h2>5-Year Savings Projection</h2>
            <p>Projected cumulative savings if current efficiency is maintained</p>
        </div>
        <div id="execProjections"></div>

    </div>

    <!-- ========================================== -->
    <!-- TECHNICAL DETAIL TAB -->
    <!-- ========================================== -->
    <div id="technical" class="tab-content" style="display: none;">

        <!-- Quick Facts Sidebar -->
        <div class="quick-facts">
            <h3>Quick Reference</h3>
            <div class="quick-fact">
                <span class="label">Base Load (non-HVAC)</span>
                <span class="value">8,622 kWh/month</span>
            </div>
            <div class="quick-fact">
                <span class="label">Heat Pumps Installed</span>
                <span class="value">Spring 2025</span>
            </div>
            <div class="quick-fact">
                <span class="label">2025 Avg $/HDD</span>
                <span class="value positive">$18.23</span>
            </div>
            <div class="quick-fact">
                <span class="label">2023 Avg $/HDD</span>
                <span class="value">$30.82</span>
            </div>
            <div class="quick-fact">
                <span class="label">Best Month $/HDD</span>
                <span class="value positive">$5.57 (Dec 2025)</span>
            </div>
        </div>

        <!-- Cost & Savings Section -->
        <div class="section-header">
            <h2>Cost & Savings Analysis</h2>
            <p>Tracking the financial impact of efficiency improvements</p>
        </div>

        <div class="charts-grid">
            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Cumulative HVAC Savings (2025)</div>
                        <div class="chart-subtitle">Monthly progression toward $54K</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="cumulativeSavingsChart"></canvas>
                </div>
            </div>

            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Monthly HVAC Savings (2025)</div>
                        <div class="chart-subtitle">Savings vs 2023 baseline</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="monthlySavingsChart"></canvas>
                </div>
            </div>

            <div class="chart-container full-width tall expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Monthly HVAC Cost Profile: 3-Year Comparison</div>
                        <div class="chart-subtitle">Dramatic reductions visible across all months</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="hvacCostProfileChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Energy vs Weather Section -->
        <div class="section-header" style="margin-top: var(--space-2xl);">
            <h2>Energy vs Weather Analysis</h2>
            <p>Understanding efficiency relative to climate conditions</p>
        </div>

        <div class="charts-grid">
            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Energy Usage vs HDD</div>
                        <div class="chart-subtitle">Each point = one month</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="scatterChart"></canvas>
                </div>
                <div class="chart-note">2025 points cluster lower = better efficiency</div>
            </div>

            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Cost Intensity Trend ($/HDD)</div>
                        <div class="chart-subtitle">Lower values = better efficiency</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="costIntensityChart"></canvas>
                </div>
                <div class="chart-note">Heat pumps installed Spring 2025</div>
            </div>

            <div class="chart-container full-width expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Energy Efficiency: kWh per HDD</div>
                        <div class="chart-subtitle">Annual averages - lower is better</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="kwhHddChart"></canvas>
                </div>
            </div>
        </div>

        <!-- HVAC Analysis Section -->
        <div class="section-header" style="margin-top: var(--space-2xl);">
            <h2>HVAC System Analysis</h2>
            <p>Detailed breakdown of heating system performance</p>
        </div>

        <div class="charts-grid">
            <div class="chart-container full-width tall expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Energy Load Breakdown: Base vs HVAC</div>
                        <div class="chart-subtitle">Stacked comparison showing HVAC reduction</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="loadBreakdownChart"></canvas>
                </div>
            </div>

            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Heat Pump Impact: Shoulder Seasons</div>
                        <div class="chart-subtitle">2024 vs 2025 (Apr-Jun, Sep-Nov)</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="heatPumpImpactChart"></canvas>
                </div>
            </div>

            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">HVAC Share of Total Energy</div>
                        <div class="chart-subtitle">Monthly percentage by year</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="hvacShareChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Tables -->
        <div class="section-header" style="margin-top: var(--space-2xl);">
            <h2>Annual Performance Summary</h2>
            <p>Key metrics across all years</p>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Year</th>
                        <th>Total Usage (kWh)</th>
                        <th>Total Cost</th>
                        <th>HVAC Cost</th>
                        <th>Total HDD</th>
                        <th>Avg $/HDD</th>
                        <th>Peak Demand (kW)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>2023</strong></td>
                        <td>433,200</td>
                        <td>$141,627</td>
                        <td>$112,783</td>
                        <td>7,663</td>
                        <td>$30.82</td>
                        <td>112.8</td>
                    </tr>
                    <tr>
                        <td><strong>2024</strong></td>
                        <td>412,600</td>
                        <td>$135,295</td>
                        <td>$106,241</td>
                        <td>7,721</td>
                        <td>$26.51</td>
                        <td>94.8</td>
                    </tr>
                    <tr class="highlight-row">
                        <td><strong>2025</strong></td>
                        <td class="trend-up">283,500</td>
                        <td class="trend-up">$98,111</td>
                        <td class="trend-up">$66,765</td>
                        <td>8,352</td>
                        <td class="trend-up">$18.23</td>
                        <td class="trend-up">92.2</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section-header" style="margin-top: var(--space-2xl);">
            <h2>Monthly Detail (2025)</h2>
            <p>Complete monthly breakdown</p>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Usage (kWh)</th>
                        <th>HDD</th>
                        <th>HVAC Cost</th>
                        <th>Monthly Savings</th>
                        <th>Cumulative</th>
                        <th>$/HDD</th>
                    </tr>
                </thead>
                <tbody id="monthlyTableBody">
                    <!-- Populated by JS -->
                </tbody>
            </table>
        </div>

    </div>

    <!-- ========================================== -->
    <!-- COMMUNITY IMPACT TAB -->
    <!-- ========================================== -->
    <div id="community" class="tab-content" style="display: none;">

        <!-- Impact Story -->
        <div class="impact-story">
            <h3>Investing in Our Future</h3>
            <p>Dá Kų, meaning "Our House" in Southern Tutchone, is the heart of our community. It's where the Dakwäkäda Dancers have performed for over 20 years, where youth learn their language, and where elders share knowledge with new generations.</p>
            <p>Every dollar saved on energy is a dollar we can invest in our people. In 2025, our building efficiency improvements saved <strong>$54,437</strong>—resources that support cultural programming, language preservation, and community gatherings.</p>

            <div class="impact-grid">
                <div class="impact-card">
                    <h4>Cultural Programming</h4>
                    <div class="value">725+ Hours</div>
                    <p>Potential additional programming funded by savings</p>
                </div>
                <div class="impact-card">
                    <h4>Language Learners</h4>
                    <div class="value">200+</div>
                    <p>Materials and resources that could be supported</p>
                </div>
                <div class="impact-card">
                    <h4>Environmental Leadership</h4>
                    <div class="value">70 Tons</div>
                    <p>CO2 emissions avoided annually</p>
                </div>
                <div class="impact-card">
                    <h4>Future Savings</h4>
                    <div class="value">$330K+</div>
                    <p>Projected 5-year cumulative savings</p>
                </div>
            </div>
        </div>

        <!-- Environmental Impact for Community -->
        <div class="section-header">
            <h2>Environmental Stewardship</h2>
            <p>Honoring our ancestors' care for the land</p>
        </div>

        <div id="communityEnvEquivalents"></div>

        <!-- Community-focused charts -->
        <div class="section-header" style="margin-top: var(--space-2xl);">
            <h2>Our Progress</h2>
            <p>Seeing our achievements over time</p>
        </div>

        <div class="charts-grid">
            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Growing Savings</div>
                        <div class="chart-subtitle">Each month adds to our success</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="communitySavingsChart"></canvas>
                </div>
            </div>

            <div class="chart-container expandable" onclick="toggleChartExpand(this)">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Year-Over-Year Improvement</div>
                        <div class="chart-subtitle">Costs decreasing each year</div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="communityComparisonChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Future Outlook -->
        <div class="section-header" style="margin-top: var(--space-2xl);">
            <h2>Looking Ahead</h2>
            <p>Projected benefits for our community</p>
        </div>

        <div id="communityProjections"></div>

        <!-- Community Message -->
        <div class="impact-story" style="margin-top: var(--space-2xl);">
            <h3>Leading by Example</h3>
            <p>CAFN's investment in building efficiency demonstrates responsible stewardship and forward-thinking governance. Our success shows other First Nations communities what's possible with strategic investment in sustainable infrastructure.</p>
            <p>As we continue this journey, we honor our ancestors who cared for this land for over 8,000 years, while building a sustainable future for the next seven generations.</p>
        </div>

    </div>

</div>

<footer>
    <p>Dá Kų Cultural Centre | Ryan Kinna, Building Engineer | Champagne and Aishihik First Nations</p>
    <p style="margin-top: 8px;">Data Source: DaKu_PowerUseMod v2.3 | Generated January 2026</p>
</footer>

<!-- JavaScript -->
<script src="js/data.js"></script>
<script src="js/components.js"></script>
<script src="js/charts.js"></script>
<script src="js/config.js"></script>

<script>
// ==========================================
// TAB NAVIGATION
// ==========================================

function switchTab(tabId) {
    // Update buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === tabId);
    });

    // Update content
    document.querySelectorAll('.tab-content').forEach(content => {
        content.style.display = content.id === tabId ? 'block' : 'none';
    });

    // Initialize charts for the tab if needed
    if (tabId === 'executive' && !window.execChartsInitialized) {
        initExecutiveCharts();
        window.execChartsInitialized = true;
    }
    if (tabId === 'technical' && !window.techChartsInitialized) {
        initTechnicalCharts();
        window.techChartsInitialized = true;
    }
    if (tabId === 'community' && !window.communityChartsInitialized) {
        initCommunityCharts();
        window.communityChartsInitialized = true;
    }

    // Resize charts after tab switch
    setTimeout(() => {
        Object.values(Chart.instances || {}).forEach(chart => {
            if (chart) chart.resize();
        });
    }, 100);
}

// ==========================================
// CHART EXPAND/COLLAPSE
// ==========================================

let expandedChart = null;

function toggleChartExpand(container) {
    const overlay = document.getElementById('chartOverlay');

    if (container.classList.contains('expanded')) {
        // Close
        container.classList.remove('expanded');
        overlay.classList.remove('visible');
        expandedChart = null;
    } else {
        // Close any other expanded chart first
        if (expandedChart) {
            expandedChart.classList.remove('expanded');
        }
        // Open this one
        container.classList.add('expanded');
        overlay.classList.add('visible');
        expandedChart = container;
    }

    // Resize the chart
    setTimeout(() => {
        const canvas = container.querySelector('canvas');
        if (canvas && Chart.getChart(canvas)) {
            Chart.getChart(canvas).resize();
        }
    }, 100);
}

function closeExpandedChart() {
    if (expandedChart) {
        expandedChart.classList.remove('expanded');
        document.getElementById('chartOverlay').classList.remove('visible');
        expandedChart = null;
    }
}

// ==========================================
// CHART INITIALIZATION
// ==========================================

Chart.register(ChartDataLabels);
Chart.defaults.font.family = "'Segoe UI', 'Helvetica', 'Arial', sans-serif";
Chart.defaults.color = '#666';

const colors = DakuCharts.colors;

// Executive Tab Charts
function initExecutiveCharts() {
    // Environmental Equivalents
    const execEnv = document.getElementById('execEnvEquivalents');
    if (execEnv) {
        DakuComponents.createEnvironmentalEquivalents(execEnv, DakuData.environmental);
    }

    // Cumulative Savings
    DakuCharts.createCumulativeSavings('execCumulativeChart', DakuData);

    // Annual Comparison
    DakuCharts.createAnnualComparison('execAnnualChart', DakuData);

    // Projections
    const projContainer = document.getElementById('execProjections');
    if (projContainer) {
        DakuComponents.createProjections(projContainer, DakuData);
    }
}

// Technical Tab Charts
function initTechnicalCharts() {
    // Cumulative Savings
    new Chart(document.getElementById('cumulativeSavingsChart'), {
        type: 'line',
        data: {
            labels: DakuData.months,
            datasets: [{
                label: 'Cumulative Savings',
                data: DakuData.savings.hvacCumulative,
                borderColor: colors.savings.border,
                backgroundColor: colors.savings.bg,
                fill: true,
                tension: 0.4,
                pointRadius: 5,
                pointBackgroundColor: colors.savings.border
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                datalabels: { display: false },
                tooltip: {
                    callbacks: {
                        label: ctx => '$' + ctx.parsed.y.toLocaleString()
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { callback: v => '$' + (v/1000) + 'k' }
                }
            }
        }
    });

    // Monthly Savings
    new Chart(document.getElementById('monthlySavingsChart'), {
        type: 'bar',
        data: {
            labels: DakuData.months,
            datasets: [{
                label: 'Monthly Savings',
                data: DakuData.savings.hvacMonthly,
                backgroundColor: colors.savings.border,
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                datalabels: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { callback: v => '$' + (v/1000) + 'k' }
                }
            }
        }
    });

    // HVAC Cost Profile
    new Chart(document.getElementById('hvacCostProfileChart'), {
        type: 'bar',
        data: {
            labels: DakuData.months,
            datasets: [
                {
                    label: '2023',
                    data: DakuData.electricity.hvacCost[2023],
                    backgroundColor: colors.year2023.bg
                },
                {
                    label: '2024',
                    data: DakuData.electricity.hvacCost[2024],
                    backgroundColor: colors.year2024.bg
                },
                {
                    label: '2025',
                    data: DakuData.electricity.hvacCost[2025],
                    backgroundColor: colors.year2025.bg
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top' },
                datalabels: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { callback: v => '$' + (v/1000) + 'k' }
                }
            }
        }
    });

    // Scatter Plot
    DakuCharts.createScatterPlot('scatterChart', DakuData);

    // Cost Intensity
    DakuCharts.createCostIntensityTrend('costIntensityChart', DakuData);

    // kWh per HDD
    const avgKwhHdd = {
        2023: DakuData.getKwhPerHdd(2023),
        2024: DakuData.getKwhPerHdd(2024),
        2025: DakuData.getKwhPerHdd(2025)
    };

    new Chart(document.getElementById('kwhHddChart'), {
        type: 'bar',
        data: {
            labels: ['2023', '2024', '2025'],
            datasets: [{
                label: 'kWh per HDD',
                data: [avgKwhHdd[2023], avgKwhHdd[2024], avgKwhHdd[2025]],
                backgroundColor: [colors.year2023.bg, colors.year2024.bg, colors.year2025.bg],
                borderColor: [colors.year2023.border, colors.year2024.border, colors.year2025.border],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: v => v.toFixed(1) + ' kWh/HDD',
                    font: { weight: 'bold' }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'kWh per HDD' }
                }
            }
        }
    });

    // Load Breakdown
    DakuCharts.createLoadBreakdown('loadBreakdownChart', DakuData);

    // Heat Pump Impact
    const shoulderMonths = ['Apr', 'May', 'Jun', 'Sep', 'Oct', 'Nov'];
    const shoulderIndices = [3, 4, 5, 8, 9, 10];

    new Chart(document.getElementById('heatPumpImpactChart'), {
        type: 'bar',
        data: {
            labels: shoulderMonths,
            datasets: [
                {
                    label: '2024',
                    data: shoulderIndices.map(i => DakuData.electricity.hvacCost[2024][i]),
                    backgroundColor: colors.year2024.bg
                },
                {
                    label: '2025 (Heat Pumps)',
                    data: shoulderIndices.map(i => DakuData.electricity.hvacCost[2025][i]),
                    backgroundColor: colors.year2025.bg
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top' },
                datalabels: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { callback: v => '$' + (v/1000) + 'k' }
                }
            }
        }
    });

    // HVAC Share
    const hvacShare = {
        2023: DakuData.getHvacUsage(2023).map((h, i) => (h / DakuData.electricity.usage[2023][i]) * 100),
        2024: DakuData.getHvacUsage(2024).map((h, i) => (h / DakuData.electricity.usage[2024][i]) * 100),
        2025: DakuData.getHvacUsage(2025).map((h, i) => (h / DakuData.electricity.usage[2025][i]) * 100)
    };

    new Chart(document.getElementById('hvacShareChart'), {
        type: 'line',
        data: {
            labels: DakuData.months,
            datasets: [
                {
                    label: '2023',
                    data: hvacShare[2023],
                    borderColor: colors.year2023.border,
                    borderWidth: 2,
                    tension: 0.3,
                    pointRadius: 3
                },
                {
                    label: '2024',
                    data: hvacShare[2024],
                    borderColor: colors.year2024.border,
                    borderWidth: 2,
                    tension: 0.3,
                    pointRadius: 3
                },
                {
                    label: '2025',
                    data: hvacShare[2025],
                    borderColor: colors.year2025.border,
                    borderWidth: 3,
                    tension: 0.3,
                    pointRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top' },
                datalabels: { display: false }
            },
            scales: {
                y: {
                    min: 0,
                    max: 100,
                    ticks: { callback: v => v + '%' }
                }
            }
        }
    });

    // Populate monthly table
    const tableBody = document.getElementById('monthlyTableBody');
    DakuData.months.forEach((month, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><strong>${month}</strong></td>
            <td>${DakuData.electricity.usage[2025][i].toLocaleString()}</td>
            <td>${DakuData.electricity.hdd[2025][i].toLocaleString()}</td>
            <td>$${DakuData.electricity.hvacCost[2025][i].toLocaleString()}</td>
            <td class="trend-up">$${DakuData.savings.hvacMonthly[i].toLocaleString()}</td>
            <td class="trend-up">$${DakuData.savings.hvacCumulative[i].toLocaleString()}</td>
            <td>$${DakuData.electricity.costIntensity[2025][i].toFixed(2)}</td>
        `;
        tableBody.appendChild(row);
    });
}

// Community Tab Charts
function initCommunityCharts() {
    // Environmental Equivalents
    const commEnv = document.getElementById('communityEnvEquivalents');
    if (commEnv) {
        DakuComponents.createEnvironmentalEquivalents(commEnv, DakuData.environmental);
    }

    // Community Savings Chart (simpler)
    new Chart(document.getElementById('communitySavingsChart'), {
        type: 'line',
        data: {
            labels: DakuData.months,
            datasets: [{
                label: 'Total Savings',
                data: DakuData.savings.hvacCumulative,
                borderColor: colors.success,
                backgroundColor: 'rgba(46, 125, 50, 0.2)',
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: colors.success
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                datalabels: {
                    display: (ctx) => ctx.dataIndex === 11, // Only show last
                    anchor: 'end',
                    align: 'top',
                    formatter: v => '$' + Math.round(v/1000) + 'k',
                    font: { weight: 'bold', size: 14 },
                    color: colors.success
                },
                tooltip: {
                    callbacks: {
                        label: ctx => '$' + ctx.parsed.y.toLocaleString() + ' saved so far'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { callback: v => '$' + (v/1000) + 'k' },
                    title: { display: true, text: 'Savings ($)' }
                }
            }
        }
    });

    // Community Comparison (simple)
    new Chart(document.getElementById('communityComparisonChart'), {
        type: 'bar',
        data: {
            labels: ['2023', '2024', '2025'],
            datasets: [{
                label: 'HVAC Cost',
                data: [
                    DakuData.kpis[2023].hvacCost,
                    DakuData.kpis[2024].hvacCost,
                    DakuData.kpis[2025].hvacCost
                ],
                backgroundColor: [colors.year2023.bg, colors.year2024.bg, colors.year2025.bg],
                borderColor: [colors.year2023.border, colors.year2024.border, colors.year2025.border],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: v => '$' + Math.round(v/1000) + 'k',
                    font: { weight: 'bold' }
                },
                tooltip: {
                    callbacks: {
                        label: ctx => 'HVAC Cost: $' + ctx.parsed.y.toLocaleString()
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { callback: v => '$' + (v/1000) + 'k' },
                    title: { display: true, text: 'Annual HVAC Cost ($)' }
                }
            }
        }
    });

    // Community Projections
    const projContainer = document.getElementById('communityProjections');
    if (projContainer) {
        DakuComponents.createProjections(projContainer, DakuData);
    }
}

// ==========================================
// INITIALIZATION
// ==========================================

document.addEventListener('DOMContentLoaded', function() {
    // Initialize executive tab charts (default tab)
    initExecutiveCharts();
    window.execChartsInitialized = true;

    // Initialize tooltips
    if (typeof DakuComponents !== 'undefined') {
        DakuComponents.initTooltips();
    }
});
</script>

</body>
</html>
