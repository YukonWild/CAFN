<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dá Kų Cultural Centre - Energy Analysis Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --cafn-dark: #1a1a2e;
            --cafn-red: #c50a27;
            --cafn-white: #ffffff;
            --primary: #005f73;
            --secondary: #0a9396;
            --accent: #ee9b00;
            --success: #2e7d32;
            --warning: #f57c00;
            --light: #f4f6f7;
            --text: #2c3e50;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--text);
        }

        /* Header */
        .report-header {
            background: linear-gradient(135deg, var(--cafn-dark) 0%, #2d2d4a 100%);
            color: var(--cafn-white);
            padding: 40px 20px;
            text-align: center;
        }

        .report-header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .report-header .subtitle {
            font-size: 1.1rem;
            opacity: 0.85;
            margin-bottom: 20px;
        }

        .report-header .meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .report-header .badge {
            background: var(--cafn-red);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Section Headers */
        .section-header {
            margin: 40px 0 25px 0;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--cafn-red);
        }

        .section-header h2 {
            font-size: 1.6rem;
            color: var(--cafn-dark);
        }

        .section-header p {
            color: #666;
            margin-top: 8px;
        }

        /* Executive Summary */
        .executive-summary {
            background: linear-gradient(135deg, var(--success) 0%, #1b5e20 100%);
            color: white;
            border-radius: 16px;
            padding: 35px;
            margin-bottom: 30px;
        }

        .executive-summary h2 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 2.8rem;
            font-weight: 700;
            line-height: 1.1;
        }

        .summary-label {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: var(--cafn-white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-left: 5px solid var(--secondary);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }

        .kpi-title {
            font-size: 0.85rem;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--cafn-dark);
            margin: 10px 0 5px 0;
        }

        .kpi-sub {
            font-size: 0.85rem;
            color: var(--success);
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 25px;
        }

        .chart-container {
            background: var(--cafn-white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
        }

        .chart-container.full-width {
            grid-column: span 2;
        }

        .chart-container.tall {
            min-height: 450px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--cafn-dark);
        }

        .chart-subtitle {
            font-size: 0.85rem;
            color: #666;
            margin-top: 3px;
        }

        .chart-wrapper {
            position: relative;
            flex-grow: 1;
            min-height: 300px;
        }

        .chart-note {
            font-size: 0.8rem;
            color: #888;
            text-align: center;
            margin-top: 12px;
            flex-shrink: 0;
        }

        /* Table Styles */
        .table-container {
            background: var(--cafn-white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        th {
            background-color: var(--cafn-dark);
            color: var(--cafn-white);
            padding: 14px 15px;
            text-align: left;
            font-weight: 600;
        }

        th:first-child { border-top-left-radius: 8px; }
        th:last-child { border-top-right-radius: 8px; }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        tr:nth-child(even) { background-color: #f8f9fa; }
        tr:hover { background-color: #f1f3f5; }

        .trend-up { color: var(--success); font-weight: 600; }
        .trend-down { color: #c62828; font-weight: 600; }
        .highlight-row { background-color: #e8f5e9 !important; }

        /* Footer */
        footer {
            background: var(--cafn-dark);
            color: rgba(255,255,255,0.7);
            text-align: center;
            padding: 25px 20px;
            font-size: 0.85rem;
        }

        footer a {
            color: var(--cafn-white);
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            .chart-container.full-width {
                grid-column: span 1;
            }
            .report-header h1 {
                font-size: 1.6rem;
            }
            .summary-value {
                font-size: 2rem;
            }
        }

        /* Print Styles */
        @media print {
            .report-header {
                background: var(--cafn-dark) !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .chart-container { break-inside: avoid; }
        }
    </style>
</head>
<body>

<!-- Header -->
<header class="report-header">
    <h1>Dá Kų Cultural Centre</h1>
    <p class="subtitle">Building Efficiency & Energy Analysis Report</p>
    <div class="meta">
        <span class="badge">2025 Annual Report</span>
        <span class="badge">Heat Pump Analysis</span>
    </div>
</header>

<div class="container">

    <!-- Executive Summary -->
    <div class="executive-summary">
        <h2>Executive Summary: Cost Savings Success</h2>
        <div class="summary-grid">
            <div class="summary-item">
                <div class="summary-value" id="totalSavings">$54,437</div>
                <div class="summary-label">Total HVAC Savings (2025)</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="efficiencyGain">41%</div>
                <div class="summary-label">Efficiency Improvement</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="costReduction">$46K</div>
                <div class="summary-label">Annual HVAC Cost Reduction</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="peakSavings">$8,318</div>
                <div class="summary-label">Best Month (December)</div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid">
        <div class="kpi-card" style="border-left-color: var(--success);">
            <div class="kpi-title">2025 Total Cost</div>
            <div class="kpi-value">$98,111</div>
            <div class="kpi-sub">Down from $141,627 (2023)</div>
        </div>
        <div class="kpi-card" style="border-left-color: var(--primary);">
            <div class="kpi-title">HVAC Cost 2025</div>
            <div class="kpi-value">$66,765</div>
            <div class="kpi-sub">Down from $112,783 (2023)</div>
        </div>
        <div class="kpi-card" style="border-left-color: var(--accent);">
            <div class="kpi-title">Total Usage 2025</div>
            <div class="kpi-value">283,500 kWh</div>
            <div class="kpi-sub">35% reduction from 2023</div>
        </div>
        <div class="kpi-card" style="border-left-color: var(--cafn-dark);">
            <div class="kpi-title">Heating Degree Days</div>
            <div class="kpi-value">8,352</div>
            <div class="kpi-sub">Climate severity tracked</div>
        </div>
    </div>

    <!-- Section: Cost & Savings -->
    <div class="section-header">
        <h2>Cost & Savings Analysis</h2>
        <p>Tracking the financial impact of efficiency improvements and heat pump installation</p>
    </div>

    <div class="charts-grid">
        <!-- Cumulative Savings Chart -->
        <div class="chart-container">
            <div class="chart-header">
                <div>
                    <div class="chart-title">Cumulative HVAC Savings (2025)</div>
                    <div class="chart-subtitle">Monthly progression toward $54K goal</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="cumulativeSavingsChart"></canvas>
            </div>
        </div>

        <!-- Monthly Savings Bar -->
        <div class="chart-container">
            <div class="chart-header">
                <div>
                    <div class="chart-title">Monthly HVAC Savings (2025)</div>
                    <div class="chart-subtitle">Savings vs 2023 baseline costs</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="monthlySavingsChart"></canvas>
            </div>
        </div>

        <!-- Annual Cost Comparison -->
        <div class="chart-container full-width">
            <div class="chart-header">
                <div>
                    <div class="chart-title">Annual Cost Comparison</div>
                    <div class="chart-subtitle">Total building and HVAC costs by year</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="annualCostChart"></canvas>
            </div>
        </div>

        <!-- Monthly HVAC Cost Profile -->
        <div class="chart-container full-width tall">
            <div class="chart-header">
                <div>
                    <div class="chart-title">Monthly HVAC Cost Profile: 3-Year Comparison</div>
                    <div class="chart-subtitle">Dramatic reductions visible in shoulder and winter months</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="hvacCostProfileChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Section: Energy vs Weather -->
    <div class="section-header">
        <h2>Energy vs Weather Analysis</h2>
        <p>Understanding how building efficiency responds to climate conditions</p>
    </div>

    <div class="charts-grid">
        <!-- Energy vs HDD Scatter -->
        <div class="chart-container">
            <div class="chart-header">
                <div>
                    <div class="chart-title">Energy Usage vs Heating Degree Days</div>
                    <div class="chart-subtitle">Each point = one month; lower = more efficient</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="scatterChart"></canvas>
            </div>
            <div class="chart-note">2025 points cluster lower, showing improved efficiency across all weather conditions</div>
        </div>

        <!-- Cost Intensity Trend -->
        <div class="chart-container">
            <div class="chart-header">
                <div>
                    <div class="chart-title">Cost Intensity Trend ($/HDD)</div>
                    <div class="chart-subtitle">Lower values = better efficiency</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="costIntensityChart"></canvas>
            </div>
            <div class="chart-note">Heat pumps installed Spring 2025 - note dramatic improvement</div>
        </div>

        <!-- kWh/HDD Performance -->
        <div class="chart-container full-width">
            <div class="chart-header">
                <div>
                    <div class="chart-title">Energy Efficiency: kWh per Heating Degree Day</div>
                    <div class="chart-subtitle">Annual averages - lower is better</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="kwhHddChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Section: HVAC Analysis -->
    <div class="section-header">
        <h2>HVAC System Analysis</h2>
        <p>Detailed breakdown of heating, ventilation, and cooling performance</p>
    </div>

    <div class="charts-grid">
        <!-- HVAC Load Breakdown -->
        <div class="chart-container full-width tall">
            <div class="chart-header">
                <div>
                    <div class="chart-title">Energy Load Breakdown: Base vs HVAC</div>
                    <div class="chart-subtitle">Stacked comparison showing HVAC reduction in 2025</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="loadBreakdownChart"></canvas>
            </div>
        </div>

        <!-- Heat Pump Impact -->
        <div class="chart-container">
            <div class="chart-header">
                <div>
                    <div class="chart-title">Heat Pump Impact: Shoulder Seasons</div>
                    <div class="chart-subtitle">2024 vs 2025 HVAC costs (Apr-Jun, Sep-Nov)</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="heatPumpImpactChart"></canvas>
            </div>
        </div>

        <!-- HVAC as % of Total -->
        <div class="chart-container">
            <div class="chart-header">
                <div>
                    <div class="chart-title">HVAC Share of Total Energy</div>
                    <div class="chart-subtitle">Monthly HVAC percentage by year</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="hvacShareChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Annual Performance Table -->
    <div class="section-header">
        <h2>Annual Performance Summary</h2>
        <p>Key metrics comparison across all years</p>
    </div>

    <div class="table-container">
        <table id="annualTable">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Total Usage (kWh)</th>
                    <th>Total Cost</th>
                    <th>HVAC Cost</th>
                    <th>Total HDD</th>
                    <th>Avg $/HDD</th>
                    <th>Peak Demand (kW)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>2023</strong></td>
                    <td>433,200</td>
                    <td>$141,627</td>
                    <td>$112,783</td>
                    <td>7,663</td>
                    <td>$30.82</td>
                    <td>112.8</td>
                </tr>
                <tr>
                    <td><strong>2024</strong></td>
                    <td>412,600</td>
                    <td>$135,295</td>
                    <td>$106,241</td>
                    <td>7,721</td>
                    <td>$26.51</td>
                    <td>94.8</td>
                </tr>
                <tr class="highlight-row">
                    <td><strong>2025</strong></td>
                    <td class="trend-up">283,500</td>
                    <td class="trend-up">$98,111</td>
                    <td class="trend-up">$66,765</td>
                    <td>8,352</td>
                    <td class="trend-up">$18.23</td>
                    <td class="trend-up">92.2</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Monthly Detail Table -->
    <div class="section-header" style="margin-top: 40px;">
        <h2>Monthly Savings Detail (2025)</h2>
        <p>Complete breakdown of monthly performance and savings</p>
    </div>

    <div class="table-container">
        <table id="monthlyTable">
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Usage (kWh)</th>
                    <th>HDD</th>
                    <th>HVAC Cost</th>
                    <th>Monthly Savings</th>
                    <th>Cumulative Savings</th>
                    <th>$/HDD</th>
                </tr>
            </thead>
            <tbody id="monthlyTableBody">
                <!-- Populated by JS -->
            </tbody>
        </table>
    </div>

</div>

<footer>
    <p>Dá Kų Cultural Centre | Ryan Kinna, Building Engineer | Champagne and Aishihik First Nations</p>
    <p style="margin-top: 8px;">Data Source: DaKu_PowerUseMod v2.3 | Generated January 2026</p>
</footer>

<script>
// ==========================================
// DATA
// ==========================================

const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

const data = {
    usage: {
        2023: [35200, 32800, 39800, 32600, 30600, 35000, 43200, 38400, 38400, 34000, 38000, 35200],
        2024: [33000, 42200, 33200, 25400, 37000, 30400, 32600, 34000, 38400, 32400, 38600, 35400],
        2025: [27600, 27200, 24800, 20200, 25000, 26700, 25300, 25900, 21900, 18700, 16800, 23400]
    },
    hdd: {
        2023: [1115.7, 1298.4, 1182.1, 856.9, 534.2, 245.6, 108.9, 112.7, 240.4, 412.5, 610.2, 945.8],
        2024: [1095.3, 1245.2, 1125.6, 798.4, 562.1, 294.5, 138.9, 165.2, 225.8, 445.6, 642.1, 982.4],
        2025: [1088.9, 1221.4, 1142.8, 812.3, 556.2, 288.7, 142.1, 185.2, 316.4, 473.5, 674.3, 1450.0]
    },
    hvacCost: {
        2023: [9096, 8427, 10379, 8372, 7830, 9246, 11653, 10315, 9988, 8675, 9790, 9010],
        2024: [8461, 11045, 8536, 6152, 9595, 7755, 8368, 8800, 10027, 8313, 10041, 9149],
        2025: [6908, 6697, 5872, 4511, 5940, 6573, 6092, 6250, 4986, 4092, 3504, 5341]
    },
    totalCost: {
        2023: [11500, 10831, 12782, 10775, 10234, 11649, 14057, 12719, 12392, 11079, 12194, 11414],
        2024: [10864, 13448, 10939, 8765, 11999, 10159, 10772, 11204, 12431, 10716, 12445, 11553],
        2025: [9378, 9193, 8524, 7242, 8580, 9102, 8711, 8831, 7715, 6739, 6028, 8070]
    },
    costIntensity: {
        2023: [10.31, 8.34, 10.81, 12.57, 19.16, 47.03, 84.12, 71.41, 47.21, 26.81, 19.98, 12.07],
        2024: [9.92, 10.80, 9.72, 10.98, 21.35, 34.49, 61.73, 52.50, 51.54, 24.98, 19.38, 11.76],
        2025: [8.61, 7.53, 7.46, 8.91, 15.43, 31.53, 48.24, 38.85, 23.44, 14.23, 8.94, 5.57]
    },
    hvacSavings: [1737, 2684, 3478, 2586, 2883, 2616, 4536, 5019, 8120, 5282, 7178, 8318],
    cumulativeSavings: [1737, 4420, 7899, 10485, 13368, 15984, 20520, 25540, 33660, 38942, 46119, 54437],
    baseLoad: 8622
};

// HVAC usage (total - base)
data.hvacUsage = {
    2023: data.usage[2023].map(u => u - data.baseLoad),
    2024: data.usage[2024].map(u => u - data.baseLoad),
    2025: data.usage[2025].map(u => u - data.baseLoad)
};

// ==========================================
// CHART CONFIGURATION
// ==========================================

Chart.register(ChartDataLabels);
Chart.defaults.font.family = "'Segoe UI', 'Helvetica', 'Arial', sans-serif";
Chart.defaults.color = '#666';

const colors = {
    2023: { bg: 'rgba(149, 165, 166, 0.6)', border: '#95a5a6' },
    2024: { bg: 'rgba(52, 152, 219, 0.6)', border: '#3498db' },
    2025: { bg: 'rgba(46, 125, 50, 0.8)', border: '#2e7d32' },
    savings: { bg: 'rgba(46, 125, 50, 0.3)', border: '#2e7d32' },
    accent: { bg: 'rgba(238, 155, 0, 0.7)', border: '#ee9b00' },
    hvac: { bg: 'rgba(197, 10, 39, 0.7)', border: '#c50a27' }
};

// ==========================================
// CHART 1: Cumulative Savings (Area)
// ==========================================
new Chart(document.getElementById('cumulativeSavingsChart'), {
    type: 'line',
    data: {
        labels: months,
        datasets: [{
            label: 'Cumulative Savings',
            data: data.cumulativeSavings,
            borderColor: colors.savings.border,
            backgroundColor: colors.savings.bg,
            fill: true,
            tension: 0.4,
            pointRadius: 5,
            pointBackgroundColor: colors.savings.border,
            datalabels: { display: false }
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    label: ctx => '$' + ctx.parsed.y.toLocaleString()
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { callback: v => '$' + (v/1000) + 'k' },
                title: { display: true, text: 'Cumulative Savings ($)' }
            }
        }
    }
});

// ==========================================
// CHART 2: Monthly Savings Bar
// ==========================================
new Chart(document.getElementById('monthlySavingsChart'), {
    type: 'bar',
    data: {
        labels: months,
        datasets: [{
            label: 'Monthly Savings',
            data: data.hvacSavings,
            backgroundColor: colors.savings.border,
            borderRadius: 4,
            datalabels: { display: false }
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { callback: v => '$' + (v/1000) + 'k' },
                title: { display: true, text: 'Savings ($)' }
            }
        }
    }
});

// ==========================================
// CHART 3: Annual Cost Comparison
// ==========================================
new Chart(document.getElementById('annualCostChart'), {
    type: 'bar',
    data: {
        labels: ['2023', '2024', '2025'],
        datasets: [
            {
                label: 'Total Building Cost',
                data: [141627, 135295, 98111],
                backgroundColor: colors[2023].bg,
                borderColor: colors[2023].border,
                borderWidth: 1,
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: v => '$' + Math.round(v/1000) + 'k',
                    font: { weight: 'bold' }
                }
            },
            {
                label: 'HVAC Cost',
                data: [112783, 106241, 66765],
                backgroundColor: colors.hvac.bg,
                borderColor: colors.hvac.border,
                borderWidth: 1,
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: v => '$' + Math.round(v/1000) + 'k',
                    font: { weight: 'bold' },
                    color: colors.hvac.border
                }
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'top' },
            tooltip: {
                callbacks: { label: ctx => ctx.dataset.label + ': $' + ctx.parsed.y.toLocaleString() }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { callback: v => '$' + (v/1000) + 'k' },
                title: { display: true, text: 'Annual Cost ($)' }
            }
        }
    }
});

// ==========================================
// CHART 4: Monthly HVAC Cost Profile
// ==========================================
new Chart(document.getElementById('hvacCostProfileChart'), {
    type: 'bar',
    data: {
        labels: months,
        datasets: [
            {
                label: '2023',
                data: data.hvacCost[2023],
                backgroundColor: colors[2023].bg,
                datalabels: { display: false }
            },
            {
                label: '2024',
                data: data.hvacCost[2024],
                backgroundColor: colors[2024].bg,
                datalabels: { display: false }
            },
            {
                label: '2025',
                data: data.hvacCost[2025],
                backgroundColor: colors[2025].bg,
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    color: colors[2025].border,
                    font: { weight: 'bold', size: 10 },
                    formatter: v => '$' + Math.round(v/1000) + 'k'
                }
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'top' },
            tooltip: {
                callbacks: { label: ctx => ctx.dataset.label + ': $' + ctx.parsed.y.toLocaleString() }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { callback: v => '$' + (v/1000) + 'k' },
                title: { display: true, text: 'Monthly HVAC Cost ($)' }
            }
        }
    }
});

// ==========================================
// CHART 5: Scatter - Energy vs HDD
// ==========================================
const scatterData = [];
[2023, 2024, 2025].forEach(year => {
    for (let i = 0; i < 12; i++) {
        scatterData.push({
            x: data.hdd[year][i],
            y: data.usage[year][i],
            year: year
        });
    }
});

new Chart(document.getElementById('scatterChart'), {
    type: 'scatter',
    data: {
        datasets: [
            {
                label: '2023',
                data: scatterData.filter(d => d.year === 2023),
                backgroundColor: colors[2023].bg,
                borderColor: colors[2023].border,
                pointRadius: 8,
                datalabels: { display: false }
            },
            {
                label: '2024',
                data: scatterData.filter(d => d.year === 2024),
                backgroundColor: colors[2024].bg,
                borderColor: colors[2024].border,
                pointRadius: 8,
                datalabels: { display: false }
            },
            {
                label: '2025',
                data: scatterData.filter(d => d.year === 2025),
                backgroundColor: colors[2025].bg,
                borderColor: colors[2025].border,
                pointRadius: 8,
                datalabels: { display: false }
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'top' },
            tooltip: {
                callbacks: {
                    label: ctx => `HDD: ${ctx.parsed.x}, Usage: ${ctx.parsed.y.toLocaleString()} kWh`
                }
            }
        },
        scales: {
            x: { title: { display: true, text: 'Heating Degree Days (HDD)' } },
            y: {
                title: { display: true, text: 'Energy Usage (kWh)' },
                ticks: { callback: v => (v/1000) + 'k' }
            }
        }
    }
});

// ==========================================
// CHART 6: Cost Intensity Line
// ==========================================
new Chart(document.getElementById('costIntensityChart'), {
    type: 'line',
    data: {
        labels: months,
        datasets: [
            {
                label: '2023',
                data: data.costIntensity[2023],
                borderColor: colors[2023].border,
                borderDash: [5, 5],
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 0,
                datalabels: { display: false }
            },
            {
                label: '2024',
                data: data.costIntensity[2024],
                borderColor: colors[2024].border,
                borderDash: [2, 2],
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 0,
                datalabels: { display: false }
            },
            {
                label: '2025',
                data: data.costIntensity[2025],
                borderColor: colors[2025].border,
                backgroundColor: 'rgba(46, 125, 50, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.3,
                datalabels: { display: false }
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'top' },
            tooltip: {
                callbacks: { label: ctx => ctx.dataset.label + ': $' + ctx.parsed.y.toFixed(2) + '/HDD' }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                title: { display: true, text: '$/HDD (lower is better)' }
            }
        }
    }
});

// ==========================================
// CHART 7: kWh/HDD Annual Average
// ==========================================
const avgKwhHdd = {
    2023: data.usage[2023].reduce((a,b) => a+b) / data.hdd[2023].reduce((a,b) => a+b),
    2024: data.usage[2024].reduce((a,b) => a+b) / data.hdd[2024].reduce((a,b) => a+b),
    2025: data.usage[2025].reduce((a,b) => a+b) / data.hdd[2025].reduce((a,b) => a+b)
};

new Chart(document.getElementById('kwhHddChart'), {
    type: 'bar',
    data: {
        labels: ['2023', '2024', '2025'],
        datasets: [{
            label: 'kWh per HDD',
            data: [avgKwhHdd[2023], avgKwhHdd[2024], avgKwhHdd[2025]],
            backgroundColor: [colors[2023].bg, colors[2024].bg, colors[2025].bg],
            borderColor: [colors[2023].border, colors[2024].border, colors[2025].border],
            borderWidth: 2,
            datalabels: {
                anchor: 'end',
                align: 'top',
                formatter: v => v.toFixed(1) + ' kWh/HDD',
                font: { weight: 'bold' }
            }
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
            y: {
                beginAtZero: true,
                title: { display: true, text: 'kWh per Heating Degree Day' }
            }
        }
    }
});

// ==========================================
// CHART 8: Load Breakdown (Stacked)
// ==========================================
new Chart(document.getElementById('loadBreakdownChart'), {
    type: 'bar',
    data: {
        labels: months,
        datasets: [
            {
                label: '2023 Base',
                data: Array(12).fill(data.baseLoad),
                backgroundColor: 'rgba(149, 165, 166, 0.4)',
                stack: '2023',
                datalabels: { display: false }
            },
            {
                label: '2023 HVAC',
                data: data.hvacUsage[2023],
                backgroundColor: colors[2023].bg,
                stack: '2023',
                datalabels: { display: false }
            },
            {
                label: '2024 Base',
                data: Array(12).fill(data.baseLoad),
                backgroundColor: 'rgba(52, 152, 219, 0.3)',
                stack: '2024',
                datalabels: { display: false }
            },
            {
                label: '2024 HVAC',
                data: data.hvacUsage[2024],
                backgroundColor: colors[2024].bg,
                stack: '2024',
                datalabels: { display: false }
            },
            {
                label: '2025 Base',
                data: Array(12).fill(data.baseLoad),
                backgroundColor: 'rgba(46, 125, 50, 0.3)',
                stack: '2025',
                datalabels: { display: false }
            },
            {
                label: '2025 HVAC',
                data: data.hvacUsage[2025],
                backgroundColor: colors[2025].bg,
                stack: '2025',
                datalabels: {
                    anchor: 'end',
                    align: 'end',
                    color: colors[2025].border,
                    font: { size: 9, weight: 'bold' },
                    formatter: (v, ctx) => Math.round((v + data.baseLoad)/1000) + 'k'
                }
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                    filter: item => !item.text.includes('Base')
                }
            }
        },
        scales: {
            x: { stacked: true },
            y: {
                stacked: true,
                title: { display: true, text: 'Energy (kWh)' },
                ticks: { callback: v => (v/1000) + 'k' }
            }
        }
    }
});

// ==========================================
// CHART 9: Heat Pump Impact (Shoulder Seasons)
// ==========================================
const shoulderMonths = ['Apr', 'May', 'Jun', 'Sep', 'Oct', 'Nov'];
const shoulderIndices = [3, 4, 5, 8, 9, 10];

new Chart(document.getElementById('heatPumpImpactChart'), {
    type: 'bar',
    data: {
        labels: shoulderMonths,
        datasets: [
            {
                label: '2024',
                data: shoulderIndices.map(i => data.hvacCost[2024][i]),
                backgroundColor: colors[2024].bg,
                borderColor: colors[2024].border,
                borderWidth: 1,
                datalabels: { display: false }
            },
            {
                label: '2025 (Heat Pumps)',
                data: shoulderIndices.map(i => data.hvacCost[2025][i]),
                backgroundColor: colors[2025].bg,
                borderColor: colors[2025].border,
                borderWidth: 1,
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    color: colors[2025].border,
                    font: { weight: 'bold', size: 10 },
                    formatter: v => '$' + Math.round(v/1000) + 'k'
                }
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'top' },
            tooltip: {
                callbacks: { label: ctx => ctx.dataset.label + ': $' + ctx.parsed.y.toLocaleString() }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { callback: v => '$' + (v/1000) + 'k' },
                title: { display: true, text: 'HVAC Cost ($)' }
            }
        }
    }
});

// ==========================================
// CHART 10: HVAC Share %
// ==========================================
const hvacShare = {
    2023: data.hvacUsage[2023].map((h, i) => (h / data.usage[2023][i]) * 100),
    2024: data.hvacUsage[2024].map((h, i) => (h / data.usage[2024][i]) * 100),
    2025: data.hvacUsage[2025].map((h, i) => (h / data.usage[2025][i]) * 100)
};

new Chart(document.getElementById('hvacShareChart'), {
    type: 'line',
    data: {
        labels: months,
        datasets: [
            {
                label: '2023',
                data: hvacShare[2023],
                borderColor: colors[2023].border,
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                datalabels: { display: false }
            },
            {
                label: '2024',
                data: hvacShare[2024],
                borderColor: colors[2024].border,
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                datalabels: { display: false }
            },
            {
                label: '2025',
                data: hvacShare[2025],
                borderColor: colors[2025].border,
                borderWidth: 3,
                tension: 0.3,
                pointRadius: 4,
                datalabels: { display: false }
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'top' },
            tooltip: {
                callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y.toFixed(1) + '%' }
            }
        },
        scales: {
            y: {
                min: 0,
                max: 100,
                title: { display: true, text: 'HVAC % of Total Usage' },
                ticks: { callback: v => v + '%' }
            }
        }
    }
});

// ==========================================
// POPULATE MONTHLY TABLE
// ==========================================
const tableBody = document.getElementById('monthlyTableBody');
months.forEach((month, i) => {
    const row = document.createElement('tr');
    row.innerHTML = `
        <td><strong>${month}</strong></td>
        <td>${data.usage[2025][i].toLocaleString()}</td>
        <td>${data.hdd[2025][i].toLocaleString()}</td>
        <td>$${data.hvacCost[2025][i].toLocaleString()}</td>
        <td class="trend-up">$${data.hvacSavings[i].toLocaleString()}</td>
        <td class="trend-up">$${data.cumulativeSavings[i].toLocaleString()}</td>
        <td>$${data.costIntensity[2025][i].toFixed(2)}</td>
    `;
    tableBody.appendChild(row);
});

</script>

</body>
</html>
